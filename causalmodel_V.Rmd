---
title: 'Fertility and Wealth: Causal Evidence for Latin America'
author: "Edison Choque Sanchez"
date: "20/05/2023"
output:
  html_document:
    toc: yes
    toc_float: yes
    code_download: no
    theme: flatly
  pdf_document:
    toc: yes
subtitle: Work in progress
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introduction

In this file we show the process to estimate the causal effect from fertility to household wealth. This process has three stages. First, we import the data base and explore it, but also we generate a subset of the data base because women are the group of analysis. Second, all the variable of interest should be created. For instance most of them should be transformed into the correct format. Finally, we show the result according to the model.

# 2. DHS program data

DHS surveys collect primary data using several types of questionnaires. A household questionnaire is used to collect information on characteristics of the household's dwelling unit, and data related to the height and weight for women and children in the household. It is also used to identify members of the household who are eligible for an individual interview. Eligible respondents are then interviewed using an individual questionnaire.

In a majority of DHS surveys eligible individuals include women of reproductive age (15-49) and men age 15-59, or in some cases 15-54. In some countries only women are interviewed. Individual questionnaires include information on fertility, family planning and maternal and child health.

We use the individual record data. It mean that all women between 15 - 49 years old were interviewed. You can visit the following website to know about DHS program and data. [DHS program](https://dhsprogram.com/data/Getting-Started.cfm){target="_blank"}

```{r include=FALSE}
library(readstata13)
library(survey)
library(srvyr)
library(dplyr)
library(tidyverse)
library(sjPlot) #html table results
library(sjmisc)
library(sjlabelled)
library(AER) # Ivreg
library(knitr) #to create frecuency tables
library(mlogit)
library(summarytools)
require(nortest)  # test for normal distribution
#library(estadistica)
library(gtools)
library(stargazer)
#library(xtable)
library(openxlsx) # to export tables to excel
```

## Loading data

```{r}
#setwd("H:/Mi unidad/Consultorias/Gus_Canavire/ProyectoDHS")
#dir()
#load("everything.Rdata")
```

In order to study specific data. First, we use two databases from 6 Latin American countries. These are Bolivia, Colombia, Republica Dominicana, Guyana, Honduras, and Haiti. This data is collected between 2005 to 2009 according to the phase 5 - DHS program.

We develop three econometrics models. Two are causal models to measure raising children's impact on household wealth. And the last one is the multinomial probit model.

To know the definition for the most of the variables, we suggest downloading the pdf files from the following link: [Files](https://dhsprogram.com/publications/publication-dhsg4-dhs-questionnaires-and-manuals.cfm){target="_blank"}. Once you enter to the link, download two pdf files: DHS-V Recode Manual and DHS-V Recode Map. In both, you can find more information about the variables and data structure.

The first econometric model considers the "infertility shock" as the instrument. The second one uses the "twins" variable as an alternative instrument. We use both the **base_ir1** and **base_ir2** for the first and second econometric models respectively. Also, we use the **base_ir3** for the multinomial probit.

This presentation keeps on with the third section which shows the description of the variables. We explain the principal results of the econometrics models in the fourth section. Finally, we present the principal conclusion and recommendations.

# 3. Generation of variables and sample restriction

```{r}
# delete variables 
base_ir1$children_categ<- NULL
base_ir2$log_score_wi<- NULL
boir$wi_cat<- NULL
```

```{r}
# view data
ver <-  base_ir1[, c( "v000", "scorewi_co", "scorewi_co")] 
View(ver)

ver <-  base_ir1[,36:76] 
View(ver)
```

```{r}
which(colnames(base_ir1) == "v213")
varlabel(ht_ir1, var.name = "v213")

table(base_ir1$pregnant)

ver <-  base_ir1[, c("v000", "v715")] 
View(ver)

hist(base_ir1$v715)
boxplot(base_ir1$v715)

```


```{r}
co5 <- filter(base_ir1, v000 %in% "BO5") # Bo5 not work to replicate the quantile index
cuantiles(bo5, variable =77,cortes = c(0.2,0.4,0.6,0.8))
bo5$wi_cat<- case_when(
  bo5$score_wi<=0.2022443~"Poorest",
  bo5$score_wi<=0.4137870~"Poorer",
  bo5$score_wi<=0.5728596~"middle",
  bo5$score_wi<=0.6809974~"Richer",
  bo5$score_wi<=1~"Richest")
table(bo5$wealth_index)
table(bo5$wi_cat)
```

# 4. Description of the Database

## Model 1: Infertility shock

In this model, the outcome/dependent variable is the wealth index score and the endogenous variable is the total number of children ever born. The database considers women with o without children.

First, we explore the dependent variable which is the Wealth index factor score:

```{r}
par(mfrow=c(1,3))
hist(base_ir1$score_wi)
```

```{r}
par(mfrow=c(1,3))
hist(base_ir1$children_home)
boxplot(base_ir1$years_education_h)
```


```{r descriptive 1.1}
quantile(base_ir1$score_wi)
sum.score <- summarytools::descr(base_ir1$score_wi)

base_ir1 %>% group_by(v000) %>%  summarise(mean = mean(score_wi),sd=sd(score_wi), n = n())
base_ir1 %>% group_by(v000) %>%  summarise(mean = mean(v191),sd=sd(v191), n = n())

base_ir1 %>% group_by(v000) %>%  summarise(mean = mean(total_children), n = n())
base_ir1 %>% group_by(v000) %>%  summarise(mean = mean(children_home), n = n())
base_ir1 %>% group_by(v000) %>%  summarise(mean = mean(living_children), n = n()) 

varlabel(coir, var.name = "v005")

base_ir1 %>% group_by(v000) %>%  summarytools::descr(children_dummy)
base_ir1 %>% group_by(v000) %>%  summarytools::descr(urban)
base_ir1 %>% group_by(v000) %>%  summarytools::descr(couple) 
base_ir1 %>% group_by(v000) %>%  summarytools::descr(instrument)
```

```{r}
base_ir1 %>% filter(v000=="CO5") %>% group_by(instrument) %>%  summarise(mean = mean(total_children), n = n())
```


```{r}
# applying svy
base_ir1<- base_ir1 %>% mutate(wt = v005/1000000) # idem, wt and v005 show the same result

des1 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(score_wi, v005, na.rm=TRUE), n = n())
des2 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(total_children, v005, na.rm=TRUE), n = n())
des3 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(age, v005, na.rm=TRUE), n = n())
des4 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(years_education, v005, na.rm=TRUE), n = n())
des5 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(years_education_h, v005, na.rm=TRUE), n = n())
des6 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(age_firstbirth, v005, na.rm=TRUE), n = n())
des7 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(urban, v005, na.rm=TRUE), n = n())
des8 <- base_ir1 %>% group_by(v000) %>% summarise(mean = weighted.mean(couple, v005, na.rm=TRUE), n = n())

des7
wb <- createWorkbook()
# Add the data to different sheets
addWorksheet(wb, "des1");writeData(wb, "des1", des1)
addWorksheet(wb, "des2");writeData(wb, "des2", des2)
addWorksheet(wb, "des3");writeData(wb, "des3", des3)
addWorksheet(wb, "des4");writeData(wb, "des4", des4)
addWorksheet(wb, "des5");writeData(wb, "des5", des5)
addWorksheet(wb, "des6"); writeData(wb, "des6", des6)
addWorksheet(wb, "des7"); writeData(wb, "des7", des7)
addWorksheet(wb, "des8"); writeData(wb, "des8", des8)

saveWorkbook(wb, file ="H:/Mi unidad/Consultorias/Gus_Canavire/R_dhs_V/Export", overwrite = TRUE)
```


Second, we describe the instrument for the endogenous variable. This instrument is defined in two ways. Both are self-declarations of infertility for women.

a)  when the question is: Main reason not to use meth, and the answer is Subfecund, infecund (infertility1).

b)  when the question is: Fertility preference, and the answer is: Declared infecund (infertility2).

According to these results, on average the number of living children in the infertile group is lower than the fertile group, so that makes sense.

```{r descriptive 1.3}
#instrument is defined as infertility1 or  infertility2
base_ir1 %>% group_by(v000,instrument) %>% summarise(mean = weighted.mean(total_children, v005, na.rm=TRUE), n = n())

#Bolivia
base_ir1 %>% filter(v000=="BO5") %>% group_by(age_group,instrument) %>%  summarise(mean = weighted.mean(total_children, v005, na.rm=TRUE), n = n())
#Colombia
base_ir1 %>% filter(v000=="CO4") %>% group_by(age_group,instrument) %>%  summarise(mean = mean(total_children), n = n()) 
#Republica Dominicana
base_ir1 %>% filter(v000=="DR5") %>% group_by(age_group,instrument) %>%  summarise(mean = mean(total_children), n = n()) 
#Guyana
base_ir1 %>% filter(v000=="GY5") %>% group_by(age_group,instrument) %>%  summarise(mean = mean(total_children), n = n()) 
#Honduras
base_ir1 %>% filter(v000=="HN5") %>% group_by(age_group,instrument) %>%  summarise(mean = mean(total_children), n = n()) 
#Haiti
base_ir1 %>% filter(v000=="HT5") %>% group_by(age_group,instrument) %>%  summarise(mean = mean(total_children), n = n()) 
```

## Model 2: Twins

In this econometric model, the outcome variable is the same as in model 1. Also, the endogenous variable is the same. But in this case, the database changed because now we consider women with equal or more than one child.

Now, we can describe the instrumental variable for model 2. This is defined as *twin*. We assume that mothers with the experience of having twins have to raise extra children. That is why it works as a good instrument to measure the causal effect.

In the next chunk, we show a summary table for the mean of the number of total children according to mothers who had twins and the ones that did not. The result shows that this average is lower for the mothers who never had twins than the ones who did, so that makes sense.


```{r}
par(mfrow=c(1,3))
hist(base_ir1$score_wi)
```

```{r}
par(mfrow=c(1,3))
hist(base_ir2$children_home)
boxplot(base_ir2$children_home)
```

```{r}
base_ir2 %>% group_by(v000) %>% cor(children_home,twin)

cor(base_ir2$children_home,base_ir2$twin)

base_ir2 %>% group_by(v000) %>%  summarytools::descr(twin)

```

```{r}
# applying svy
des1 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(score_wi, v005, na.rm=TRUE), n = n())
des2 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(total_children, v005, na.rm=TRUE), n = n())
des3 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(age, v005, na.rm=TRUE), n = n())
des4 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(years_education, v005, na.rm=TRUE), n = n())
des5 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(years_education_h, v005, na.rm=TRUE), n = n())
des6 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(age_firstbirth, v005, na.rm=TRUE), n = n())
des7 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(urban, v005, na.rm=TRUE), n = n())
des8 <- base_ir2 %>% group_by(v000) %>% summarise(mean = weighted.mean(couple, v005, na.rm=TRUE), n = n())

des7
wb <- createWorkbook()
# Add the data to different sheets
addWorksheet(wb, "des1");writeData(wb, "des1", des1)
addWorksheet(wb, "des2");writeData(wb, "des2", des2)
addWorksheet(wb, "des3");writeData(wb, "des3", des3)
addWorksheet(wb, "des4");writeData(wb, "des4", des4)
addWorksheet(wb, "des5");writeData(wb, "des5", des5)
addWorksheet(wb, "des6"); writeData(wb, "des6", des6)
addWorksheet(wb, "des7"); writeData(wb, "des7", des7)
addWorksheet(wb, "des8"); writeData(wb, "des8", des8)

saveWorkbook(wb, file ="H:/Mi unidad/Consultorias/Gus_Canavire/R_dhs_V/Export", overwrite = TRUE)

```


```{r descriptive 2.1}

base_ir2 %>% group_by(v000,twin) %>% summarise(mean = weighted.mean(total_children, v005, na.rm=TRUE), n = n())

base_ir2 %>% filter(v000=="CO4") %>% group_by(twin) %>%  summarise(mean = mean(score_wi), sd=sd(score_wi), n = n())

base_ir2 %>% filter(v000=="DR5") %>% group_by(twin) %>%  summarise(mean = mean(living_children), n = n())
base_ir2 %>% filter(v000=="GY5") %>% group_by(twin) %>%  summarise(mean = mean(total_children), n = n())
base_ir2 %>% filter(v000=="HN5") %>% group_by(twin) %>%  summarise(mean = mean(total_children), n = n())

```

Finally, we present the description for the rest of the variables for model 2.

```{r}
base_ir2 %>% group_by(v000) %>%  summarytools::descr(urban)
varlabel(drir, var.name = "v715")
base_ir2 %>% group_by(v000) %>%  summarytools::descr(couple)

```

## Comparison

```{r}
ggplot(base_ir1, aes(x = score_wi)) + 
  geom_histogram() + 
  facet_wrap(~v000, ncol = 6)

ggplot(base_ir2, aes(x = score_wi)) + 
  geom_histogram() + 
  facet_wrap(~v000, ncol = 6)

```


# 5. Econometrics Models

## Model 1: Infertility shock

Definition of the dependent variables:

-   score_wi: score_wi to get a better interpretation

Definition of the endogenous variables:

-   total_children: total children ever born

Definition of the instrument:

-   instrument: infertility1 or infertility2 defined above

Control variables are defined as follow:

-   age: Current age - respondent
-   year_education: Education in single years
-   urban: the responded live in urban area



### model 4.1 OLS

total_childen
```{r}
m0_lmw_bo5 <- lm(score_wi ~ total_children + age + age_firstbirth +couple + years_education + urban,
                 data = base_ir1, subset = v000 %in% "BO5", weights = v005)
m0_lmw_co4 <- lm(score_wi ~ total_children + age  + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "CO4", weights = v005)
m0_lmw_dr5 <- lm(score_wi ~ total_children + age + age_firstbirth +couple +  years_education + urban,
                 data = base_ir1, subset = v000 %in% "DR5", weights = v005)
m0_lmw_gy5 <- lm(score_wi ~ total_children + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "GY5", weights = v005)
m0_lmw_hn5 <- lm(score_wi ~ total_children + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "HN5", weights = v005)
m0_lmw_ht5 <- lm(score_wi ~ total_children + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "HT5", weights = v005)


stargazer(m0_lmw_co4,m0_lmw_gy5,m0_lmw_dr5,m0_lmw_bo5, m0_lmw_hn5,m0_lmw_ht5, digits=2,title = "OLS regression - Phase V", ci.level = 0.95,column.labels = c("Colombia", "Guyana","Dominican Republic", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("total_children", "Constant"), type = "text")
```

living_children
```{r}
m0_lmw_bo5 <- lm(score_wi ~ living_children + age + age_firstbirth +couple + years_education + urban,
                 data = base_ir1, subset = v000 %in% "BO5", weights = v005)
m0_lmw_co4 <- lm(score_wi ~ living_children + age  + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "CO4", weights = v005)
m0_lmw_dr5 <- lm(score_wi ~ living_children + age + age_firstbirth +couple +  years_education + urban,
                 data = base_ir1, subset = v000 %in% "DR5", weights = v005)
m0_lmw_gy5 <- lm(score_wi ~ living_children + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "GY5", weights = v005)
m0_lmw_hn5 <- lm(score_wi ~ living_children + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "HN5", weights = v005)
m0_lmw_ht5 <- lm(score_wi ~ living_children + age + age_firstbirth +couple + years_education  + urban,
              data = base_ir1, subset = v000 %in% "HT5", weights = v005)


stargazer(m0_lmw_co4,m0_lmw_gy5,m0_lmw_dr5,m0_lmw_bo5, m0_lmw_hn5,m0_lmw_ht5, digits=2,title = "OLS regression - Phase V", ci.level = 0.95,column.labels = c("Colombia", "Guyana","Dominican-Republic", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("living_children", "Constant"), type = "text")

stargazer(m0_lmw_co4,m0_lmw_gy5,m0_lmw_dr5,m0_lmw_bo5, m0_lmw_hn5, digits=2,title = "OLS regression - Phase V", ci.level = 0.95,column.labels = c("Colombia", "Guyana","Dominican-Republic", "Bolivia", "Honduras"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("living_children", "Constant"), type = "text")

```

children_home
```{r}
m0_lmwbo5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education + urban,
                 data = base_ir1, subset = v000 %in% "BO5", weights = v005)
m0_lmwco4 <- lm(score_wi ~ children_home + age  + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "CO4", weights = v005)
m0_lmwdr5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple +  years_education + urban,
                 data = base_ir1, subset = v000 %in% "DR5", weights = v005)
m0_lmwgy5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "GY5", weights = v005)
m0_lmwhn5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "HN5", weights = v005)
m0_lmwht5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education  + urban,
              data = base_ir1, subset = v000 %in% "HT5", weights = v005)


stargazer(m0_lmwgy5,m0_lmwco4,m0_lmwhn5,m0_lmwbo5, m0_lmwdr5, m0_lmwht5, digits=2,title = "OLS regression - Phase V", ci.level = 0.95,column.labels = c("Guyana","Colombia" ,"Honduras","Bolivia","Dominican-Republic","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("children_home", "Constant"), type = "text")
```


with no instrument and dummy children
```{r}
m0_lmw_bo5 <- lm(score_wi ~ children_dummy + age + age_firstbirth +couple + years_education + urban,
                 data = base_ir1, subset = v000 %in% "BO5", weights = v005)
m0_lmw_co4 <- lm(score_wi ~ children_dummy + age  + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "CO4", weights = v005)
m0_lmw_dr5 <- lm(score_wi ~ children_dummy + age + age_firstbirth +couple +  years_education + urban,
                 data = base_ir1, subset = v000 %in% "DR5", weights = v005)
m0_lmw_gy5 <- lm(score_wi ~ children_dummy + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "GY5", weights = v005)
m0_lmw_hn5 <- lm(score_wi ~ children_dummy + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "HN5", weights = v005)
m0_lmw_ht5 <- lm(score_wi ~ children_dummy + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir1, subset = v000 %in% "HT5", weights = v005)
#stargazer(m0_lmw_bo5, m0_lmw_co4, m0_lmw_dr5,m0_lmw_gy5,m0_lmw_hn5,m0_lmw_ht5,digits=2, type = "text")
stargazer(m0_lmw_bo5, m0_lmw_co4, m0_lmw_dr5,m0_lmw_gy5,m0_lmw_hn5,m0_lmw_ht5,digits=2, type = "text")
```

Next, we try to measure the quentile effect

```{r}
m0_lmw_bo5 <- lm(score_wi ~ total_children + age + age_firstbirth +couple + years_education + urban,
                 data = base_ir1, subset = v000 %in% "BO5", weights = v005)
stargazer(m0_lmw_bo5, digits=3, type = "text")
```

```{r}
m0_qr25_bo5 <- rq(score_wi ~ total_children + age + age_firstbirth +couple + years_education + urban, data = base_ir1, subset = v000 %in% "BO5", weights = v005, tau=c(0.25))
m0_qr50_bo5 <- rq(score_wi ~ total_children + age + age_firstbirth +couple + years_education + urban, data = base_ir1, subset = v000 %in% "BO5", weights = v005, tau=c(0.50))
m0_qr75_bo5 <- rq(score_wi ~ total_children + age + age_firstbirth +couple + years_education + urban, data = base_ir1, subset = v000 %in% "BO5", weights = v005, tau=c(0.75))
stargazer(m0_qr25_bo5,m0_qr50_bo5, m0_qr75_bo5, digits=3, type = "text")
```

```{r}
anova(m0_qr25_bo5, m0_qr50_bo5)
```

```{r}
m0_qrall_bo5 <- rq(score_wi ~ total_children + age + age_firstbirth +couple + years_education + urban, data = base_ir1, subset = v000 %in% "BO5", weights = v005, tau=seq(0.1,0.9, by=0.1))
qr_plot<- summary(m0_qrall_bo5)
plot(qr_plot)
#stargazer(m0_qrall_bo5,digits=2, type = "text")
```

### model 4.2 IV

```{r}
base_ir1<- base_ir1 %>% mutate(wt = v005/1000000) # not change de stadistic significance
```

total_children
```{r include=FALSE}

m1_ivco5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban | age + age_firstbirth +couple + years_education + urban + instrument, data = base_ir1,
                subset = v000 %in% "CO4", weights = v005)

m1_ivdr5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "DR5", weights = v005)
m1_ivgy5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "GY5", weights = v005)

m1_ivbo5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "BO5", weights = v005)

m1_ivhn5 <- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban   |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HN5", weights = v005)

m1_ivht5 <- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HT5", weights = v005)


stargazer(m1_ivco5, m1_ivgy5,m1_ivdr5,m1_ivbo5, m1_ivhn5, m1_ivht5, digits=2,title = "IV regression - Phase V", ci.level = 0.95,column.labels = c("Colombia", "Guyana","Dominican
Republic", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("total_children", "Constant"), type = "text")

#tab_model(m1_iv1w_co6, m1_iv1w_dr6,m1_iv1w_hn6,m1_iv1w_ht6
        #  ,collapse.ci = TRUE, p.style = "stars",dv.labels = c("Colombia", 
         #   "Rep.Dominicana","Honduras","Haiti"))
```

firs stage total children
```{r include=FALSE}

m1_ivco5<- lm(total_children~ instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
              subset = v000 %in% "CO4", weights = v005)

m1_ivdr5<- lm(total_children~ instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "DR5", weights = v005)
m1_ivgy5<- lm(total_children~ instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "GY5", weights = v005)

m1_ivbo5<- lm(total_children~ instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "BO5", weights = v005)

m1_ivhn5 <- lm(total_children~ instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HN5", weights = v005)

m1_ivht5 <- lm(total_children~ instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HT5", weights = v005)


stargazer(m1_ivco5, m1_ivgy5,m1_ivdr5,m1_ivbo5, m1_ivhn5, m1_ivht5, digits=2,title = "First stage regression - Phase V", ci.level = 0.95,column.labels = c("Colombia", "Guyana","Dominican
Republic", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("instrument", "Constant"), type = "text")

#tab_model(m1_iv1w_co6, m1_iv1w_dr6,m1_iv1w_hn6,m1_iv1w_ht6
        #  ,collapse.ci = TRUE, p.style = "stars",dv.labels = c("Colombia", 
         #   "Rep.Dominicana","Honduras","Haiti"))
```

```{r}
# First stage 
cig_s1 <- lm(log(rprice) ~ salestax, data = c1995)
```

```{r}
#Endogeneity test and Stock-Yogo test
summary(m1_ivco5, diagnostics=TRUE)$diagnostics
summary(m1_ivgy5, diagnostics=TRUE)$diagnostics
summary(m1_ivdr5, diagnostics=TRUE)$diagnostics
summary(m1_ivbo5, diagnostics=TRUE)$diagnostics
summary(m1_ivhn5, diagnostics=TRUE)$diagnostics
summary(m1_ivht5, diagnostics=TRUE)$diagnostics
```


Now, with living children 

```{r}
m1_ivdr5<- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "DR5", weights = v005)
m1_ivgy5<- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "GY5", weights = v005)

m1_ivco5<- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + urban |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "CO4", weights = v005)

m1_ivbo5<- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + urban |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "BO5", weights = v005)

m1_ivhn5 <- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + urban   |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HN5", weights = v005)

m1_ivht5 <- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m1_ivgy5,m1_ivco5,m1_ivdr5,m1_ivbo5, m1_ivhn5, m1_ivht5, digits=2,title = "IV regression - Phase V", ci.level = 0.95,column.labels = c("Guyana","Colombia","Dominican
Republic", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("living_children", "Constant"), type = "text")
```

Children home
```{r}
m1_ivdr5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "DR5", weights = v005)
m1_ivgy5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "GY5", weights = v005)

m1_ivco5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "CO4", weights = v005)

m1_ivbo5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "BO5", weights = v005)

m1_ivhn5 <- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban   |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HN5", weights = v005)

m1_ivht5 <- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban  |instrument + age + age_firstbirth +couple + years_education + urban, data = base_ir1,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m1_ivco5,m1_ivdr5,m1_ivgy5,m1_ivbo5, m1_ivhn5, m1_ivht5, digits=2,title = "IV regression - Phase V", ci.level = 0.95,column.labels = c("Colombia","Dominican
Republic", "Guyana", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("children_home", "Constant"), type = "text")
```

Children home + edu_husband
```{r}
m1_ivdr5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education +years_education_h + urban  |instrument + age + age_firstbirth +couple + years_education+years_education_h + urban, data = base_ir1,
                subset = v000 %in% "DR5", weights = v005)
m1_ivgy5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education +years_education_h+ urban  |instrument + age + age_firstbirth +couple + years_education+years_education_h + urban, data = base_ir1,
                subset = v000 %in% "GY5", weights = v005)

m1_ivco5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education+years_education_h + urban |instrument + age + age_firstbirth +couple + years_education+years_education_h + urban, data = base_ir1,
                subset = v000 %in% "CO4", weights = v005)

m1_ivbo5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education +years_education_h+ urban |instrument + age + age_firstbirth +couple + years_education+years_education_h + urban, data = base_ir1,
                subset = v000 %in% "BO5", weights = v005)

m1_ivhn5 <- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education +years_education_h+ urban   |instrument + age + age_firstbirth +couple + years_education+years_education_h + urban, data = base_ir1,
                subset = v000 %in% "HN5", weights = v005)

m1_ivht5 <- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education+years_education_h + urban  |instrument + age + age_firstbirth +couple + years_education +years_education_h+ urban, data = base_ir1,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m1_ivdr5, m1_ivgy5, m1_ivco5,m1_ivbo5, m1_ivhn5, m1_ivht5,digits=2, ci.level = 0.95,column.labels = c("Rep.Dominicana", "Guyana", "Colombia", "Bolivia", "Honduras","Haiti"), type = "text")
```

The principal results show that the causal effect from fertility to the score of wealth index in negative for Bolivia, Colombia, Rep. Dominicana and Honduras. These coeficientes are between 0.88 and 5.09 for each child. Also, we can see that these results are statistically significant.

It is important to notice that the causal effect from the *total_children* variable is small in average for each children, except for Colombia. Moreover, notice that we applied the sample weigth for each sample separately in order to have a country implication for the results.

According to the test for weak instrument, we reject the null hypothesis for the countries we mention before. It means that the instruments are good enough to predict a causal effect.


## Model 2: Twins

Definition of the dependent variables:

-   score_wi: Wealth index factor score in log

Definition of the endogenous variables:

-   total_children: total children ever born

Control variables are defined as follow:

-   age: Current age - respondent
-   age_firstbirth: Age of respondent at 1st birth
-   year_education: Education in single years
-   urban: the responded live in urban area

### Model 4.3 OLS 

children_home
```{r}
m0_lmwbo5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education + urban,
                 data = base_ir2, subset = v000 %in% "BO5", weights = v005)
m0_lmwco4 <- lm(score_wi ~ children_home + age  + age_firstbirth +couple + years_education  + urban,
                 data = base_ir2, subset = v000 %in% "CO4", weights = v005)
m0_lmwdr5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple +  years_education + urban,
                 data = base_ir2, subset = v000 %in% "DR5", weights = v005)
m0_lmwgy5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir2, subset = v000 %in% "GY5", weights = v005)
m0_lmwhn5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education  + urban,
                 data = base_ir2, subset = v000 %in% "HN5", weights = v005)
m0_lmwht5 <- lm(score_wi ~ children_home + age + age_firstbirth +couple + years_education  + urban,
              data = base_ir2, subset = v000 %in% "HT5", weights = v005)


stargazer(m0_lmwgy5,m0_lmwhn5,m0_lmwco4, m0_lmwbo5,m0_lmwht5, m0_lmwdr5, digits=2,title = "OLS regression model 2 - Phase V", ci.level = 0.95,column.labels = c("Guyana","Honduras","Colombia","Bolivia","Haiti","Dominican Republic"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("children_home", "Constant"), type = "text")

```

### Model 4.4 IV

twin2 with base base_ir1  -> not work


Total children
```{r}
m2_ivdr5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban  |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "DR5", weights = v005)
m2_ivgy5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban  |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "GY5", weights = v005)

m2_ivco5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "CO4", weights = v005)

m2_ivbo5<- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "BO5", weights = v005)

m2_ivhn5 <- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban   |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HN5", weights = v005)

m2_ivht5 <- ivreg(score_wi~ total_children + age + age_firstbirth +couple + years_education + urban  |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m2_ivco5,m2_ivgy5,m2_ivhn5, m2_ivht5,m2_ivdr5,m2_ivbo5, digits=2,title = "IV regression model 2- Phase V", ci.level = 0.95,column.labels = c("Colombia","Guyana","Honduras","Haiti","Dominican Republic", "Bolivia"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("total_children", "Constant"), type = "text")
```

FS for Total children
```{r}
m2_ivdr5<- lm(total_children~ twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "DR5", weights = v005)
m2_ivgy5<- lm(total_children~ twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "GY5", weights = v005)

m2_ivco5<- lm(total_children~ twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "CO4", weights = v005)

m2_ivbo5<- lm(total_children~ twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "BO5", weights = v005)

m2_ivhn5 <- lm(total_children~ twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HN5", weights = v005)

m2_ivht5 <- lm(total_children~ twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m2_ivco5,m2_ivgy5,m2_ivhn5, m2_ivht5,m2_ivdr5,m2_ivbo5, digits=2,title = "First stage regression model 2- Phase V", ci.level = 0.95,column.labels = c("Colombia","Guyana","Honduras","Haiti","Dominican Republic", "Bolivia"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("twin", "Constant"), type = "text")
```

```{r}
#Endogeneity test 
summary(m2_ivhn5, diagnostics=TRUE)$diagnostics
summary(m2_ivco5, diagnostics=TRUE)$diagnostics
summary(m2_ivgy5, diagnostics=TRUE)$diagnostics
summary(m2_ivht5, diagnostics=TRUE)$diagnostics
summary(m2_ivdr5, diagnostics=TRUE)$diagnostics
summary(m2_ivbo5, diagnostics=TRUE)$diagnostics
```

living children
```{r}
m2_ivdr5<- ivreg(score_wi~ living_children + age + age_firstbirth+pregnant +couple + years_education + urban  |twin + age + age_firstbirth+pregnant +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "DR5", weights = v005)
m2_ivgy5<- ivreg(score_wi~ living_children + age + age_firstbirth+pregnant +couple + years_education + urban  |twin + age + age_firstbirth+pregnant +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "GY5", weights = v005)

m2_ivco5<- ivreg(score_wi~ living_children + age + age_firstbirth+pregnant +couple + years_education + urban |twin + age + age_firstbirth+pregnant +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "CO4", weights = v005)

m2_ivbo5<- ivreg(score_wi~ living_children + age + age_firstbirth+pregnant +couple + years_education + urban |twin + age + age_firstbirth+pregnant +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "BO5", weights = v005)

m2_ivhn5 <- ivreg(score_wi~ living_children + age + age_firstbirth +pregnant+couple + years_education + urban   |twin + age + age_firstbirth+pregnant +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HN5", weights = v005)

m2_ivht5 <- ivreg(score_wi~ living_children + age + age_firstbirth +pregnant+couple + years_education + urban  |twin + age + age_firstbirth+pregnant +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m2_ivco5,m2_ivgy5,m2_ivdr5,m2_ivbo5, m2_ivhn5, m2_ivht5, digits=2,title = "IV regression model 2- Phase V", ci.level = 0.95,column.labels = c("Colombia","Guyana","Dominican Republic", "Bolivia", "Honduras","Haiti"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("living_children", "Constant"), type = "text")
```


children home
```{r}
m2_ivdr5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban  |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "DR5", weights = v005)
m2_ivgy5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban  |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "GY5", weights = v005)

m2_ivco5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "CO4", weights = v005)

m2_ivbo5<- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "BO5", weights = v005)

m2_ivhn5 <- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban   |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HN5", weights = v005)

m2_ivht5 <- ivreg(score_wi~ children_home + age + age_firstbirth +couple + years_education + urban  |twin + age + age_firstbirth +couple + years_education + urban, data = base_ir2,
                subset = v000 %in% "HT5", weights = v005)

stargazer(m2_ivhn5,m2_ivco5,m2_ivgy5, m2_ivht5,m2_ivdr5,m2_ivbo5, digits=2,title = "IV regression model 2- Phase V", ci.level = 0.95,column.labels = c("Honduras","Colombia","Guyana","Haiti","Dominican Republic", "Bolivia"), notes="Sample weights were used. Std. Errors are in parenthesis", notes.align=c("l"),keep=c("children_home", "Constant"), type = "text")
```


The principal result shows that the casual effect from fertility over the score of wealth index is statistically significant for the Colombia, Rep. Dominicana, Honduras y Haiti. Again, Colombia has the biggest impact related to others countries. But still the impacts, in general, are small, similar to the marginal causal effects that we found above for the model 1.

According to the test for weak instrument, we reject the null hypothesis for the countries we mention before. It means that the instruments are good enough to predict a causal effect.

with husband education and pregnant

```{r}
m2_iv1w_co6<- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education +  years_education_h+ pregnant+urban  |twin + age + age_firstbirth +couple + years_education + years_education_h + pregnant+urban, data = base_ir2,
                   subset = v000 %in% "CO5", weights = v005)

m2_iv1w_dr6<- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + years_education_h+ pregnant+urban |twin + age + age_firstbirth +couple + years_education + years_education_h+ pregnant+ urban, data = base_ir2, subset = v000 %in% "DR6", weights = v005)

m2_iv1w_hn6 <- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + years_education_h+ pregnant+ urban  |twin + age + age_firstbirth +couple + years_education + years_education_h+ pregnant+ urban, data = base_ir2, subset = v000 %in% "HN6", weights = v005)

m2_iv1w_ht6 <- ivreg(score_wi~ living_children + age + age_firstbirth +couple + years_education + years_education_h+ pregnant+ urban |twin + age + age_firstbirth +couple + years_education + years_education_h+ pregnant+ urban, data = base_ir2,
                    subset = v000 %in% "HT6", weights = v005)

stargazer(m2_iv1w_co6, m2_iv1w_dr6,m2_iv1w_hn6,m2_iv1w_ht6,digits=2, ci.level = 0.95,column.labels = c("Colombia",  "Rep.Dominicana","Honduras","Haiti"), type = "text")
```


# 6. Discussion and Conclusions

The causal effect from fertility over the score of wealth index is negative for the model 1 and model 2. But differ among countries. So, we can conclude that the marginal causal effect is statistically significant, but this is small. Why?

We think that the difficulty of interpreting these impacts is related to the meaning of the standardized wealth index scores. If we remember the categorical expression of the wealth index, it shows 5 types: poorest, poor, middle, richer, and richest. So according to our results, For instance Reducing by 2 points on a scale between 0 -100 means passing from middle to poor category?

However, in the results from model 3, it is clear the direction of the probability for the wealth index if the number of children increases. So, we can understand that the causal effect we find is related to this interpretation. In order words, there is a causal effect of fertility over household wealth.

There are three aspect to consider in order to improve this preliminary results:

-   We should consider the test for the external validation like Hansen test
-   We can use a restriction for the maximum age of the children living.
-   We can consider other control variables like education of husbands and others.
-   We can consider other outcome like participation in labor market
